<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hentai Hub</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: white;
}
header {
  padding: 15px;
  background: #181818;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.upload {
  cursor: pointer;
}
main {
  padding: 15px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 15px;
}
.video-card {
  background: #202020;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  position: relative;
}
.video-card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
}
.video-info {
  padding: 8px;
  font-size: 14px;
}
/* Delete button */
.delete-btn {
  position: absolute;
  top: 6px;
  right: 6px;
  background: rgba(0,0,0,0.7);
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
  padding: 4px 6px;
  border-radius: 4px;
}
.delete-btn:hover {
  background: red;
}
.player {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  align-items: center;
  justify-content: center;
}
.player video {
  width: 80%;
  max-height: 80%;
}
.close {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 30px;
  cursor: pointer;
}
</style>
</head>
<body>

<header>
  <h2>Hentai Hub</h2>
  <label class="upload">
    Upload
    <input type="file" accept="video/*" hidden id="upload">
  </label>
</header>

<main id="videos"></main>

<div class="player" id="player">
  <span class="close" onclick="closePlayer()">âœ•</span>
  <video controls id="playerVideo"></video>
</div>

<script>
// Elements
const uploadInput = document.getElementById('upload');
const videosDiv = document.getElementById('videos');
const player = document.getElementById('player');
const playerVideo = document.getElementById('playerVideo');

// Load videos from server
async function loadVideos() {
  videosDiv.innerHTML = '';
  const res = await fetch('/videos');
  const videos = await res.json();

  videos.forEach(v => {
    const card = document.createElement('div');
    card.className = 'video-card';

    // Thumbnail: use a single frame from video
    const img = document.createElement('img');
    img.src = ''; // placeholder

    // Generate thumbnail
    const vid = document.createElement('video');
    vid.src = v.url;
    vid.muted = true;
    vid.currentTime = 1;
    vid.onloadeddata = () => {
      const canvas = document.createElement('canvas');
      canvas.width = 320;
      canvas.height = 180;
      canvas.getContext('2d').drawImage(vid, 0, 0, 320, 180);
      img.src = canvas.toDataURL('image/png');
    };

    // Delete button
    const delBtn = document.createElement('button');
    delBtn.className = 'delete-btn';
    delBtn.textContent = 'ðŸ—‘';
    delBtn.onclick = async (e) => {
      e.stopPropagation();
      if(!confirm('Delete this video?')) return;
      await fetch(`/videos/${v.filename}`, { method: 'DELETE' });
      loadVideos();
    };

    const info = document.createElement('div');
    info.className = 'video-info';
    info.textContent = v.filename;

    card.appendChild(delBtn);
    card.appendChild(img);
    card.appendChild(info);

    card.onclick = () => playVideo(v.url);
    videosDiv.prepend(card);
  });
}

// Play video
function playVideo(src) {
  player.style.display = 'flex';
  playerVideo.src = src;
  playerVideo.play();
}

function closePlayer() {
  player.style.display = 'none';
  playerVideo.pause();
  playerVideo.src = '';
}

// Upload video
uploadInput.onchange = async () => {
  const file = uploadInput.files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append('video', file);

  await fetch('/upload', { method: 'POST', body: formData });
  uploadInput.value = '';
  loadVideos();
};

// Initial load
loadVideos();
</script>

</body>
</html>
